<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>한빔한복 무료상담</title>
  <link rel="stylesheet" href="style.css?v=20260302-SSOT-1" />
</head>
<body>

<main class="landing">

  <section class="block">
    <img src="assets/01_hero.webp" alt="히어로">
  </section>

  <section class="block short">
    <img src="assets/03_store_intro.webp" alt="매장소개">
  </section>

  <section class="block short">
    <img src="assets/01_design.webp" alt="강점소개">
  </section>

  <section class="block short">
    <img src="assets/01_accesary.webp" alt="예약고객혜택">
  </section>

  <section class="block short">
    <img src="assets/01_cs.webp" alt="고객만족서비스">
  </section>

  <!-- 08 지점별 네이버링크 (오버레이) -->
  <section class="block block-overlay naver-grid">
    <img src="assets/08_naver_links.webp" alt="지점별 네이버 예약">
    <div class="overlay-layer" id="naverOverlay" aria-label="지점별 네이버 예약 오버레이"></div>
  </section>

  <section class="block">
    <img src="assets/09_footer.webp" alt="푸터">
  </section>

</main>

<!-- ✅ Toast -->
<div id="toast" role="status" aria-live="polite"></div>

<!-- =========================
   ✅ Hanbeam Fixed CTA : 지점선택 + 액션버튼
   ========================= -->
<div class="hb-fixed-cta" id="hbFixedCta" aria-label="하단 고정 CTA">
  <button class="hb-branchBtn" id="hbOpenBranch" type="button" aria-label="지점 선택">
    <span class="hb-branchTxt" id="hbBranchText">가까운 지점 선택하기</span>
    <svg class="hb-chevron" viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M6 9L12 15L18 9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
    </svg>
  </button>

  <div class="hb-actionPanel" aria-label="바로가기 버튼">
    <a class="hb-action" id="hbBtnCall" href="#" aria-label="전화문의">
      <span class="hb-ico" style="background-image:url('assets/btn-call.png');"></span>
      <span class="hb-lbl">전화문의</span>
    </a>

    <a class="hb-action" id="hbBtnKakao" href="#" aria-label="카톡문의">
      <span class="hb-ico" style="background-image:url('assets/btn-kakao.png');"></span>
      <span class="hb-lbl">카톡문의</span>
    </a>

    <a class="hb-action" id="hbBtnReserve" href="#" aria-label="네이버예약">
      <span class="hb-ico" style="background-image:url('assets/btn-reserve.png');"></span>
      <span class="hb-lbl">네이버예약</span>
    </a>

    <a class="hb-action" id="hbBtnMore" href="https://hanbeam.co.kr/9" aria-label="더 알아보기">
      <span class="hb-ico" style="background-image:url('assets/btn-more.png');"></span>
      <span class="hb-lbl">더 알아보기</span>
    </a>
  </div>
</div>

<!-- =========================
     ✅ 지점 선택 모달
     ========================= -->
<div class="hb-branchBackdrop" id="hbBranchBackdrop" aria-hidden="true">
  <div class="hb-modal" role="dialog" aria-modal="true" aria-label="지점 선택">
    <div class="hb-modalHead">
      <div>지점 선택</div>
      <button id="hbCloseBranch" type="button">닫기</button>
    </div>
    <div class="hb-modalBody" id="hbBranchList"></div>
  </div>
</div>

<script>
  // =========================
  // ✅ CONFIG
  // =========================
  const GAS_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbyiPaERPD1ZUBNO7T40wR5Tcy0jU0qtw5SRwBylCHAvRSjafqHOLGkAWGhxKyUgCerM/exec".trim();

  // =========================
  // ✅ Toast (null-safe)
  // =========================
  const toastEl = document.getElementById('toast');
  let toastTimer = null;
  function showToast(msg){
    if(!toastEl){ alert(msg); return; }
    toastEl.textContent = String(msg || "");
    toastEl.classList.add('show');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(()=>toastEl.classList.remove('show'), 2200);
  }

  // =========================
  // ✅ Session + Logger
  // =========================
  function getHBSessionId(){
    const k="HB_LANDING_SID";
    let v = localStorage.getItem(k);
    if(!v){
      const c = (typeof window !== "undefined") ? window.crypto : null;
      v = (c && typeof c.randomUUID === "function")
        ? c.randomUUID()
        : (Date.now()+"_"+Math.random().toString(16).slice(2));
      localStorage.setItem(k,v);
    }
    return v;
  }

  function sendClickEvent({ action, branch, source } = {}){
    const payloadObj = {
      type: "click",
      action: String(action || "").trim(),
      branch: String(branch || "").trim(),   // ✅ 표준 지점명만
      source: String(source || "").trim(),
      sessionId: getHBSessionId(),
      page: location.pathname || "/",
      referrer: document.referrer || "",
      ua: navigator.userAgent || "",
      ts: Date.now()
    };

    const payload = JSON.stringify(payloadObj);

    try{
      if(navigator.sendBeacon){
        navigator.sendBeacon(GAS_WEBAPP_URL, payload);
        return;
      }
    }catch(e){}

    try{
      fetch(GAS_WEBAPP_URL, { method:"POST", body: payload, keepalive:true }).catch(()=>{});
    }catch(e){}
  }

  // =========================================================
  // ✅ SINGLE SOURCE OF TRUTH (지점 마스터) - 오버레이/CTA/로그/리포트 공통
  // =========================================================
  const MASTER_BRANCHES = [
    { key:"busan",   name:"부산점",  status:"open",
      reserve:"https://m.booking.naver.com/booking/6/bizes/661812",
      overlay:"https://m.booking.naver.com/booking/6/bizes/661812",
      phone:"051.634.2325", kakao:"https://open.kakao.com/o/soq7Ns4d" },

    // ✅ 센텀 예약 URL을 1577219로 통일 (사고 방지)
    { key:"centum",  name:"센텀점",  status:"open",
      reserve:"https://booking.naver.com/booking/6/bizes/1577219",
      overlay:"https://booking.naver.com/booking/6/bizes/1577219",
      phone:"010-3052-2325", kakao:null },

    { key:"ulsan",   name:"울산점",  status:"open",
      reserve:"https://booking.naver.com/booking/6/bizes/1534767",
      overlay:"https://booking.naver.com/booking/6/bizes/1534767",
      phone:"010.9807.2325", kakao:"https://open.kakao.com/o/sKjCbA0h" },

    { key:"gimhae",  name:"김해점",  status:"open",
      reserve:"https://booking.naver.com/booking/6/bizes/1402679",
      overlay:"https://booking.naver.com/booking/6/bizes/1402679",
      phone:"010.8065.2325", kakao:"https://open.kakao.com/o/sHM2wwsh" },

    // ✅ 양산 868629 유지
    { key:"yangsan", name:"양산점",  status:"open",
      reserve:"https://booking.naver.com/booking/13/bizes/868629",
      overlay:"https://booking.naver.com/booking/13/bizes/868629",
      phone:"055.912.0425", kakao:"https://open.kakao.com/o/sp44Hxaf" },

    { key:"changwon",name:"창원점",  status:"open",
      reserve:"https://booking.naver.com/booking/6/bizes/843111",
      overlay:"https://booking.naver.com/booking/6/bizes/843111",
      phone:"055.263.2325", kakao:"https://open.kakao.com/o/sdcvbh5e" },

    { key:"masan",   name:"마산점",  status:"open",
      reserve:"https://booking.naver.com/booking/6/bizes/1526541",
      overlay:"https://booking.naver.com/booking/6/bizes/1526541",
      phone:"010.8832.2325", kakao:"https://open.kakao.com/o/ssWvuvYh" },

    { key:"jinju",   name:"진주점",  status:"open",
      reserve:"https://m.booking.naver.com/booking/6/bizes/1485854",
      overlay:"https://m.booking.naver.com/booking/6/bizes/1485854",
      phone:"010.5654.2407", kakao:"https://open.kakao.com/o/sbxBToNh" },

    { key:"incheon", name:"인천점",  status:"open",
      reserve:"https://m.booking.naver.com/booking/13/bizes/1039475",
      overlay:"https://m.booking.naver.com/booking/13/bizes/1039475",
      phone:"032.283.2325", kakao:"https://open.kakao.com/o/sIrXajUf" },

    { key:"ansan",   name:"안산점",  status:"open",
      reserve:"https://m.booking.naver.com/booking/6/bizes/1500008",
      overlay:"https://m.booking.naver.com/booking/6/bizes/1500008",
      phone:"010.6591.2322", kakao:"https://open.kakao.com/o/sqRSjaRh" },

    { key:"daegu",   name:"대구점",  status:"open",
      reserve:"https://m.booking.naver.com/booking/6/bizes/1600152",
      overlay:"https://m.booking.naver.com/booking/6/bizes/1600152",
      phone:"010-8492-2328", kakao:null },

    { key:"pohang",  name:"포항점",  status:"coming",
      reserve:"", overlay:"",
      phone:"", kakao:null }
  ];

  // =========================
  // ✅ 08 네이버 예약 오버레이 좌표
  // =========================
  const NAVER_BASE_W = 1080;
  const NAVER_BASE_H = 937.2;

  const NAVER_RECTS = {
    busan:   { x: 69, y:225, w:292, h:146 },
    centum:  { x:394, y:225, w:292, h:146 },
    ulsan:   { x:719, y:225, w:292, h:146 },
    gimhae:  { x: 69, y:395, w:292, h:146 },
    yangsan: { x:394, y:395, w:292, h:146 },
    changwon:{ x:719, y:395, w:292, h:146 },
    masan:   { x: 69, y:565, w:292, h:146 },
    jinju:   { x:394, y:565, w:292, h:146 },
    incheon: { x:719, y:565, w:292, h:146 },
    ansan:   { x: 69, y:734, w:292, h:146 },
    daegu:   { x:394, y:734, w:292, h:146 },
    pohang:  { x:719, y:734, w:292, h:146 },
  };

  function makeOverlayLink(b, rect){
    const a = document.createElement('a');
    a.className = "ov";
    a.href = b.overlay || b.reserve || "#";
    a.target = "_blank";
    a.rel = "noopener noreferrer";
    a.setAttribute("aria-label", `${b.name} 네이버 예약`);
    a.dataset.x = rect.x; a.dataset.y = rect.y; a.dataset.w = rect.w; a.dataset.h = rect.h;

    a.addEventListener('click', ()=>{
      sendClickEvent({ action:"reserve", branch: b.name, source:"overlay" });
    }, { capture:true });

    return a;
  }

  function makeOverlayComing(b, rect){
    const btn = document.createElement('button');
    btn.type = "button";
    btn.className = "ov";
    btn.setAttribute("aria-label", `${b.name} 오픈 준비중`);
    btn.dataset.x = rect.x; btn.dataset.y = rect.y; btn.dataset.w = rect.w; btn.dataset.h = rect.h;

    btn.addEventListener('click', ()=>{
      showToast('오픈 준비중입니다.');
      sendClickEvent({ action:"coming", branch: b.name, source:"overlay" });
    });

    return btn;
  }

  function applyRectsForSection(sectionSelector, baseW, baseH){
    const sec = document.querySelector(sectionSelector);
    if(!sec) return;

    const img = sec.querySelector('img');
    const overlay = sec.querySelector('.overlay-layer');
    if(!img || !overlay) return;

    const run = ()=>{
      const cw = img.clientWidth || 0;
      const ch = img.clientHeight || 0;
      if(!cw || !ch) return;

      const hBase = (baseH != null) ? baseH : (img.naturalHeight || ch);
      const sx = cw / baseW;
      const sy = ch / hBase;

      overlay.querySelectorAll('.ov').forEach(el=>{
        const x = Number(el.dataset.x || 0);
        const y = Number(el.dataset.y || 0);
        const w = Number(el.dataset.w || 0);
        const h = Number(el.dataset.h || 0);
        el.style.left   = (x * sx) + "px";
        el.style.top    = (y * sy) + "px";
        el.style.width  = (w * sx) + "px";
        el.style.height = (h * sy) + "px";
      });
    };

    if (img.complete) run();
    else img.addEventListener('load', run, { once:true });
  }

  function buildOverlays(){
    const wrap = document.getElementById('naverOverlay');
    if(!wrap) return;
    wrap.innerHTML = "";

    MASTER_BRANCHES.forEach(b=>{
      const r = NAVER_RECTS[b.key];
      if(!r) return;
      wrap.appendChild(b.status === "open" ? makeOverlayLink(b, r) : makeOverlayComing(b, r));
    });

    applyRectsForSection('.naver-grid', NAVER_BASE_W, NAVER_BASE_H);
  }

  window.addEventListener('resize', ()=> applyRectsForSection('.naver-grid', NAVER_BASE_W, NAVER_BASE_H));
  buildOverlays();

  // =========================
  // ✅ Hanbeam Fixed CTA Logic (MASTER_BRANCHES 재사용)
  // =========================
  (function(){
    const state = { branch: null };

    function toTelHref(phone){
      const digits = String(phone || "").replace(/[^\d]/g,"");
      return digits ? ("tel:" + digits) : "";
    }

    const openBtn = document.getElementById("hbOpenBranch");
    const branchText = document.getElementById("hbBranchText");

    const bd = document.getElementById("hbBranchBackdrop");
    const closeBtn = document.getElementById("hbCloseBranch");
    const list = document.getElementById("hbBranchList");

    const btnCall = document.getElementById("hbBtnCall");
    const btnKakao = document.getElementById("hbBtnKakao");
    const btnReserve = document.getElementById("hbBtnReserve");
    const btnMore = document.getElementById("hbBtnMore");

    if(!openBtn || !bd || !list || !btnCall || !btnKakao || !btnReserve || !btnMore) return;

    function openModal(){
      bd.classList.add("open");
      bd.setAttribute("aria-hidden", "false");
    }
    function closeModal(){
      bd.classList.remove("open");
      bd.setAttribute("aria-hidden", "true");
    }

    function selectBranch(b){
      state.branch = b;
      branchText.textContent = `${b.name} 선택됨 (변경하려면 클릭)`;
      sendClickEvent({ action:"branch_select", branch:b.name, source:"cta" });
      closeModal();
    }

    function renderList(){
      list.innerHTML = "";
      MASTER_BRANCHES
        .filter(b=>b.status==="open") // coming 제외
        .forEach(b=>{
          const row = document.createElement("div");
          row.className = "hb-item";
          row.innerHTML = `<div>${b.name}</div><div class="hb-badge">선택</div>`;
          row.addEventListener("click", ()=> selectBranch(b));
          list.appendChild(row);
        });
    }

    function requireBranchOrOpen(e){
      if(!state.branch){
        e.preventDefault();
        openModal();
        return true;
      }
      return false;
    }

    renderList();
    openBtn.addEventListener("click", openModal);
    closeBtn.addEventListener("click", closeModal);
    bd.addEventListener("click", (e)=>{ if(e.target === bd) closeModal(); });

    btnCall.addEventListener("click", (e)=>{
      e.preventDefault();
      if(requireBranchOrOpen(e)) return;

      const telHref = toTelHref(state.branch.phone);
      if(!telHref) return;

      sendClickEvent({ action:"call", branch:state.branch.name, source:"cta" });
      window.location.href = telHref;
    });

    btnKakao.addEventListener("click", (e)=>{
      e.preventDefault();
      if(requireBranchOrOpen(e)) return;

      const href = state.branch.kakao;
      if(!href){
        showToast("준비중입니다.");
        sendClickEvent({ action:"kakao_pending", branch:state.branch.name, source:"cta" });
        return;
      }
      sendClickEvent({ action:"kakao", branch:state.branch.name, source:"cta" });
      window.open(href, "_blank", "noopener,noreferrer");
    });

    btnReserve.addEventListener("click", (e)=>{
      e.preventDefault();
      if(requireBranchOrOpen(e)) return;

      const href = state.branch.reserve || "";
      if(!href) return;

      sendClickEvent({ action:"reserve", branch:state.branch.name, source:"cta" });
      window.open(href, "_blank", "noopener,noreferrer");
    });

    btnMore.addEventListener("click", ()=>{
      sendClickEvent({ action:"more", branch:(state.branch?.name || ""), source:"cta" });
    });

    function setHbCtaHeightVar(){
      const cta = document.getElementById("hbFixedCta");
      const h = cta ? Math.round(cta.getBoundingClientRect().height) : 0;
      document.documentElement.style.setProperty('--ctaH', h + 'px');
    }
    window.addEventListener('resize', setHbCtaHeightVar);
    window.addEventListener('orientationchange', ()=> setTimeout(setHbCtaHeightVar, 250));
    window.addEventListener('load', ()=> setTimeout(setHbCtaHeightVar, 50));
    setHbCtaHeightVar();
  })();
</script>

</body>
</html>
