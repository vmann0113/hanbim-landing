<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>한빔한복 무료상담</title>
  <link rel="stylesheet" href="style.css?v=20260112-200" />

  <!-- ✅ iPhone date-picker / overlay 클릭 이슈 핫픽스 (style.css 위에 "덮어쓰기"용) -->
  <style>
    /* ✅ iOS에서 date input 터치 씹힘 방지: overlay 내부 폼요소는 확실히 터치 허용 */
    .overlay-layer input,
    .overlay-layer select,
    .overlay-layer textarea,
    .overlay-layer button,
    .overlay-layer a{
      pointer-events:auto !important;
    }

    /* ✅ ov 공통 z-index 올려서 덮임 방지 */
    .ov{ z-index: 20; }

    /* ✅ iOS Safari: date는 네이티브 UI라 더 강하게 올림 */
    .ov-date{
      position:absolute;
      z-index: 999 !important;
      pointer-events:auto !important;
      -webkit-appearance: none;
      appearance: none;
    }

    /* ✅ iOS: indicator 영역을 0으로 만들면 캘린더가 안 열릴 수 있음 */
    .ov-date::-webkit-calendar-picker-indicator{
      opacity:0; /* 아이콘만 숨김, 영역은 유지 */
    }

    /* ✅ fixed CTA / toast safe-area 반영 */
    .fixed-cta{
      bottom: calc(10px + env(safe-area-inset-bottom));
    }
    #toast{
      bottom: calc(120px + env(safe-area-inset-bottom));
    }

    /* (선택) 텍스트 자동 확대 방지 안정화 */
    html{ -webkit-text-size-adjust: 100%; }
  </style>
</head>
<body>

<main class="landing">

  <!-- 01 히어로 -->
  <section class="block">
    <img src="assets/01_hero.webp" alt="히어로">
  </section>

  <!-- 03 매장소개 (높이 변경/축소) -->
  <section class="block short">
    <img src="assets/03_store_intro.webp" alt="매장소개">
  </section>

  <!-- 01 디자인 보유 (높이 변경/축소) -->
  <section class="block short">
    <img src="assets/01_design.webp" alt="강점소개">
  </section>

  <!-- 01 악세사리 제공 (높이 변경/축소) -->
  <section class="block short">
    <img src="assets/01_accesary.webp" alt="예약고객혜택">
  </section>

  <!-- 01 고객만족서비스 (높이 변경/축소) -->
  <section class="block short">
    <img src="assets/01_cs.webp" alt="고객만족서비스">
  </section>

  <!-- 08 지점별 네이버링크 (오버레이) -->
  <section class="block block-overlay naver-grid">
    <img src="assets/08_naver_links.webp" alt="지점별 네이버 예약">
    <div class="overlay-layer" id="naverOverlay"></div>
  </section>

      <!-- ✅ iOS 안정: date는 네이티브 UI에 맡기는 게 제일 안정적 -->
      <input class="ov ov-date" name="date" type="date" required>

      <button class="ov ov-submit" type="submit" aria-label="제출하기"></button>
    </form>
  </section>

  <!-- 09 푸터 -->
  <section class="block">
    <img src="assets/09_footer.webp" alt="푸터">
  </section>

</main>

<!-- =========================
   ✅ FIXED CTA : 지점선택 + 액션버튼 (추가)
   ========================= -->
<div class="hb-fixed-cta" id="hbFixedCta" aria-label="하단 고정 CTA">
  <!-- 지점 선택 버튼(와인색) -->
  <button class="hb-branchBtn" id="hbOpenBranch" type="button" aria-label="지점 선택">
    <span class="hb-branchTxt" id="hbBranchText">가까운 지점 선택하기</span>
    <svg class="hb-chevron" viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M6 9L12 15L18 9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
    </svg>
  </button>

  <!-- 액션 버튼 -->
  <div class="hb-actionPanel" aria-label="바로가기 버튼">
    <a class="hb-action" id="hbBtnCall" href="#" aria-label="전화문의">
      <span class="hb-ico" style="background-image:url('assets/btn-call.png');"></span>
      <span class="hb-lbl">전화문의</span>
    </a>

    <a class="hb-action" id="hbBtnKakao" href="#" aria-label="카톡문의">
      <span class="hb-ico" style="background-image:url('assets/btn-kakao.png');"></span>
      <span class="hb-lbl">카톡문의</span>
    </a>

    <a class="hb-action" id="hbBtnReserve" href="#" aria-label="네이버예약">
      <span class="hb-ico" style="background-image:url('assets/btn-reserve.png');"></span>
      <span class="hb-lbl">네이버예약</span>
    </a>

    <a class="hb-action" id="hbBtnMore" href="https://hanbeam.co.kr/9" aria-label="더 알아보기">
      <span class="hb-ico" style="background-image:url('assets/btn-more.png');"></span>
      <span class="hb-lbl">더 알아보기</span>
    </a>
  </div>
</div>

<!-- =========================
     ✅ 지점 선택 모달 (추가)
     ========================= -->
<div class="hb-branchBackdrop" id="hbBranchBackdrop" aria-hidden="true">
  <div class="hb-modal" role="dialog" aria-modal="true" aria-label="지점 선택">
    <div class="hb-modalHead">
      <div>지점 선택</div>
      <button id="hbCloseBranch" type="button">닫기</button>
    </div>
    <div class="hb-modalBody" id="hbBranchList"></div>
  </div>
</div>

<script>
  const GAS_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbyiPaERPD1ZUBNO7T40wR5Tcy0jU0qtw5SRwBylCHAvRSjafqHOLGkAWGhxKyUgCerM/exec".trim();

  /* ==================================================
     ✅ 리포트 수집 (CLICK 로그) - 여기만 핵심 수정
     - action: reserve/call/kakao/more/branch_select 등
     - branch: 지점명
     - source: overlay/cta 등(분석용, 리포트 합산에는 영향 없음)
     ================================================== */

  function getHBSessionId(){
    const k="HB_LANDING_SID";
    let v = localStorage.getItem(k);
    if(!v){
      const c = (typeof window !== "undefined") ? window.crypto : null;
      v = (c && typeof c.randomUUID === "function")
        ? c.randomUUID()
        : (Date.now()+"_"+Math.random().toString(16).slice(2));
      localStorage.setItem(k,v);
    }
    return v;
  }

  // ✅ 새 로거: action 기반
  function sendClickEvent({ action, branch, source } = {}){
    const payloadObj = {
      type: "click",
      action: String(action || "").trim(),
      branch: String(branch || "").trim(),
      source: String(source || "").trim(),
      sessionId: getHBSessionId(),
      page: location.pathname || "/",
      referrer: document.referrer || "",
      ua: navigator.userAgent || "",
      ts: Date.now()
    };

    const payload = JSON.stringify(payloadObj);

    try{
      if(navigator.sendBeacon){
        navigator.sendBeacon(GAS_WEBAPP_URL, payload);
        return;
      }
    }catch(e){}

    fetch(GAS_WEBAPP_URL, { method:"POST", body: payload, keepalive:true }).catch(()=>{});
  }

  // ✅ 기존 코드 호환용(혹시 다른 곳에서 sendClick(branchName) 호출해도 깨지지 않게)
  function sendClick(branchName){
    sendClickEvent({ action:"reserve", branch: branchName, source:"overlay" });
  }

  // ✅ 오버레이(지점별 네이버예약) 클릭 → action="reserve" 로 통일 기록
  document.addEventListener('click', (e)=>{
    const a = e.target.closest('a[data-branch]');
    if(!a) return;
    const branchName = (a.dataset.branch || "").trim();
    if(!branchName) return;

    // 오버레이 예약 클릭은 무조건 reserve로 기록
    sendClickEvent({ action:"reserve", branch: branchName, source:"overlay" });
  }, true);


  // -------------------------------
  // 아래는 기존 코드 (유지)
  // -------------------------------

  // 토스트
  const toast = document.getElementById('toast');
  let toastTimer = null;
  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add('show');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(()=>toast.classList.remove('show'),2200);
  }

  // ✅ KB FIX: fixed CTA 높이를 CSS 변수로 반영(스크롤/포커스 보정에 사용)
  function setCtaHeightVar(){
    const cta = document.querySelector('.fixed-cta');
    const h = cta ? Math.round(cta.getBoundingClientRect().height) : 0;
    document.documentElement.style.setProperty('--ctaH', h + 'px');
  }
  window.addEventListener('resize', setCtaHeightVar);
  window.addEventListener('orientationchange', ()=> setTimeout(setCtaHeightVar, 250));
  window.addEventListener('load', ()=> setTimeout(setCtaHeightVar, 50));

  // CTA 이미지 로드 후에도 한번 더 (모바일에서 높이 변화 대응)
  const ctaImg = document.querySelector('.cta-picture img');
  if (ctaImg && !ctaImg.complete) ctaImg.addEventListener('load', setCtaHeightVar, { once:true });
  setCtaHeightVar();

  // ✅ KB FIX: 포커스 요소가 키보드/CTA에 가리면 자동으로 올려주는 유틸
  (function KeyboardSafeFocus(){
    const FORM_SECTION_SEL = '#formSection';

    function isEditable(el){
      if(!el) return false;
      const t = (el.tagName || '').toLowerCase();
      return t === 'input' || t === 'textarea' || t === 'select' || el.isContentEditable;
    }

    function getBottomOverlay(){
      const cta = document.querySelector('.fixed-cta');
      const ctaH = cta ? cta.getBoundingClientRect().height : 0;
      return Math.max(16, Math.round(ctaH) + 16);
    }

    function ensureVisible(el){
      if(!isEditable(el)) return;
      if(!el.closest(FORM_SECTION_SEL)) return;

      const vv = window.visualViewport;
      const vh = vv ? vv.height : window.innerHeight;

      const r = el.getBoundingClientRect();
      const bottomSafe = vh - getBottomOverlay();
      const topSafe = 12;

      if (r.bottom > bottomSafe) {
        const dy = (r.bottom - bottomSafe) + 12;
        window.scrollBy({ top: dy, left: 0, behavior: 'smooth' });
        return;
      }
      if (r.top < topSafe) {
        const dy = (topSafe - r.top) + 12;
        window.scrollBy({ top: -dy, left: 0, behavior: 'smooth' });
        return;
      }
    }

    function ensureVisibleTwice(el){
      requestAnimationFrame(()=>ensureVisible(el));
      setTimeout(()=>ensureVisible(el), 80);
      setTimeout(()=>ensureVisible(el), 250);
    }

    document.addEventListener('focusin', (e) => {
      ensureVisibleTwice(e.target);
    });

    if (window.visualViewport) {
      let t = null;
      window.visualViewport.addEventListener('resize', () => {
        clearTimeout(t);
        t = setTimeout(() => ensureVisibleTwice(document.activeElement), 50);
      });
    }

    window.__ensureFormFieldVisible = ensureVisibleTwice;
  })();

  // 폼 섹션으로 이동
  function goToForm(){
    const sec = document.getElementById('formSection');
    sec?.scrollIntoView({behavior:'smooth', block:'start'});

    setTimeout(()=>{
      const first = document.querySelector('.ov-name');
      first?.focus();
      if (first && window.__ensureFormFieldVisible) window.__ensureFormFieldVisible(first);
    }, 450);
  }

  // ✅ 하단 CTA 클릭 → 폼 이동
  document.querySelector('.fixed-cta-click')?.addEventListener('click', goToForm);

  // 차별성 CTA → 폼 이동
  document.querySelector('.ov-store-cta')?.addEventListener('click', goToForm);

  // 연락처 자동 하이픈
  const phone = document.querySelector('.ov-phone');
  phone?.addEventListener('input', ()=>{
    let n = phone.value.replace(/[^0-9]/g,'').slice(0,11);
    phone.value =
      n.length < 4 ? n :
      n.length < 8 ? n.slice(0,3)+'-'+n.slice(3) :
      n.slice(0,3)+'-'+n.slice(3,7)+'-'+n.slice(7);
  });

  // 지점 12개
  const BRANCHES = [
    { key:"busan",   name:"부산점",  status:"open",   url:"https://m.booking.naver.com/booking/6/bizes/661812" },
    { key:"centum",  name:"센텀점",  status:"open",   url:"https://booking.naver.com/booking/6/bizes/1577219" },
    { key:"ulsan",   name:"울산점",  status:"open",   url:"https://booking.naver.com/booking/6/bizes/1534767" },
    { key:"gimhae",  name:"김해점",  status:"open",   url:"https://booking.naver.com/booking/6/bizes/1402679" },
    { key:"yangsan", name:"양산점",  status:"open",   url:"https://booking.naver.com/booking/13/bizes/868629" },
    { key:"changwon",name:"창원점",  status:"open",   url:"https://booking.naver.com/booking/6/bizes/843111" },
    { key:"masan",   name:"마산점",  status:"open",   url:"https://booking.naver.com/booking/6/bizes/1526541" },
    { key:"jinju",   name:"진주점",  status:"open",   url:"https://m.booking.naver.com/booking/6/bizes/1485854" },
    { key:"incheon", name:"인천점",  status:"open",   url:"https://m.booking.naver.com/booking/13/bizes/1039475" },
    { key:"ansan",   name:"안산점",  status:"open",   url:"https://m.booking.naver.com/booking/6/bizes/1500008" },
    { key:"daegu",   name:"대구점",  status:"open",   url:"https://m.booking.naver.com/booking/6/bizes/1600152" },
    { key:"pohang",  name:"포항점",  status:"coming", url:"" },
  ];

  const NAVER_BASE_W = 1080;
  const NAVER_BASE_H = 937.2;
  const NAVER_RECTS = {
    busan:   { x: 69, y:225, w:292, h:146 },
    centum:  { x:394, y:225, w:292, h:146 },
    ulsan:   { x:719, y:225, w:292, h:146 },
    gimhae:  { x: 69, y:395, w:292, h:146 },
    yangsan: { x:394, y:395, w:292, h:146 },
    changwon:{ x:719, y:395, w:292, h:146 },
    masan:   { x: 69, y:565, w:292, h:146 },
    jinju:   { x:394, y:565, w:292, h:146 },
    incheon: { x:719, y:565, w:292, h:146 },
    ansan:   { x: 69, y:734, w:292, h:146 },
    daegu:   { x:394, y:734, w:292, h:146 },
    pohang:  { x:719, y:734, w:292, h:146 },
  };

  function makeLink(branch, rect){
    const a = document.createElement('a');
    a.className = "ov";
    a.href = branch.url;
    a.target = "_blank";
    a.rel = "noopener noreferrer";
    a.setAttribute("data-branch", branch.name);
    a.setAttribute("aria-label", `${branch.name} 네이버 예약`);
    a.dataset.x = rect.x; a.dataset.y = rect.y; a.dataset.w = rect.w; a.dataset.h = rect.h;
    return a;
  }

  function makeComing(branch, rect){
    const btn = document.createElement('button');
    btn.type = "button";
    btn.className = "ov";
    btn.setAttribute("aria-label", `${branch.name} 오픈 준비중`);
    btn.dataset.x = rect.x; btn.dataset.y = rect.y; btn.dataset.w = rect.w; btn.dataset.h = rect.h;

    // 오픈 준비중은 클릭 집계(원하면 유지)
    btn.addEventListener('click', ()=>{
      showToast('오픈 준비중입니다.');
      sendClickEvent({ action:"coming", branch: branch.name, source:"overlay" });
    });

    return btn;
  }

  function applyRectsForSection(sectionSelector, baseW, baseH){
    const sec = document.querySelector(sectionSelector);
    if(!sec) return;

    const img = sec.querySelector('img');
    const overlay = sec.querySelector('.overlay-layer');
    if(!img || !overlay) return;

    const run = ()=>{
      const cw = img.clientWidth || 0;
      const ch = img.clientHeight || 0;
      if(!cw || !ch) return;

      const hBase = (baseH != null) ? baseH : (img.naturalHeight || ch);
      const sx = cw / baseW;
      const sy = ch / hBase;

      overlay.querySelectorAll('.ov').forEach(el=>{
        const x = Number(el.dataset.x || 0);
        const y = Number(el.dataset.y || 0);
        const w = Number(el.dataset.w || 0);
        const h = Number(el.dataset.h || 0);
        el.style.left   = (x * sx) + "px";
        el.style.top    = (y * sy) + "px";
        el.style.width  = (w * sx) + "px";
        el.style.height = (h * sy) + "px";
        el.style.background = "transparent";
        el.style.border = "none";
        el.style.cursor = "pointer";
      });
    };

    if (img.complete) run();
    else img.addEventListener('load', run, { once:true });
  }

  function buildOverlays(){
    const naverWrap  = document.getElementById('naverOverlay');
    if(naverWrap) naverWrap.innerHTML  = "";

    BRANCHES.forEach(b=>{
      if(!naverWrap) return;
      const r = NAVER_RECTS[b.key];
      if(!r) return;
      naverWrap.appendChild(b.status === "open" ? makeLink(b, r) : makeComing(b, r));
    });

    applyRectsForSection('.naver-grid',  NAVER_BASE_W, NAVER_BASE_H);
  }

  window.addEventListener('resize', ()=>{
    applyRectsForSection('.naver-grid',  NAVER_BASE_W, NAVER_BASE_H);
  });

  // start
  buildOverlays();

  /* ==================================================
     ✅ Hanbeam Fixed CTA Logic (ADD ONLY)
     - 리포트는 action/branch로 통일 기록
     ================================================== */
  (function(){
    const HB_CTA_BRANCHES = [
      { name:"부산점",     phone:"051.634.2325", reserve:"https://m.booking.naver.com/booking/6/bizes/661812",  kakao:"https://open.kakao.com/o/soq7Ns4d" },
      { name:"부산센텀점", phone:"010-3052-2325", reserve:"https://booking.naver.com/booking/13/bizes/868629", kakao:null },
      { name:"김해점",     phone:"010.8065.2325", reserve:"https://booking.naver.com/booking/6/bizes/1402679", kakao:"https://open.kakao.com/o/sHM2wwsh" },
      { name:"창원점",     phone:"055.263.2325", reserve:"https://booking.naver.com/booking/6/bizes/843111",  kakao:"https://open.kakao.com/o/sdcvbh5e" },
      { name:"양산점",     phone:"055.912.0425", reserve:"https://booking.naver.com/booking/13/bizes/868629", kakao:"https://open.kakao.com/o/sp44Hxaf" },
      { name:"진주점",     phone:"010.5654.2407", reserve:"https://m.booking.naver.com/booking/6/bizes/1485854", kakao:"https://open.kakao.com/o/sbxBToNh" },
      { name:"인천점",     phone:"032.283.2325", reserve:"https://m.booking.naver.com/booking/13/bizes/1039475", kakao:"https://open.kakao.com/o/sIrXajUf" },
      { name:"안산점",     phone:"010.6591.2322", reserve:"https://m.booking.naver.com/booking/6/bizes/1500008", kakao:"https://open.kakao.com/o/sqRSjaRh" },
      { name:"마산점",     phone:"010.8832.2325", reserve:"https://booking.naver.com/booking/6/bizes/1526541", kakao:"https://open.kakao.com/o/ssWvuvYh" },
      { name:"울산점",     phone:"010.9807.2325", reserve:"https://booking.naver.com/booking/6/bizes/1534767", kakao:"https://open.kakao.com/o/sKjCbA0h" },
      { name:"대구점",     phone:"010-8492-2328", reserve:"https://m.place.naver.com/place/2043617700/ticket?entry=pll&bk_query=%ED%95%9C%EB%B9%94%ED%95%9C%EB%B3%B5", kakao:"https://open.kakao.com/o/sqPdeNfi" }
    ];

    const toastFallback = (msg)=> alert(msg);
    const safeToast = (typeof window.showToast === "function") ? window.showToast : toastFallback;

    const state = { branch: null };

    function toTelHref(phone){
      const digits = String(phone || "").replace(/[^\d]/g,"");
      return digits ? ("tel:" + digits) : "";
    }

    const openBtn = document.getElementById("hbOpenBranch");
    const branchText = document.getElementById("hbBranchText");

    const bd = document.getElementById("hbBranchBackdrop");
    const closeBtn = document.getElementById("hbCloseBranch");
    const list = document.getElementById("hbBranchList");

    const btnCall = document.getElementById("hbBtnCall");
    const btnKakao = document.getElementById("hbBtnKakao");
    const btnReserve = document.getElementById("hbBtnReserve");
    const btnMore = document.getElementById("hbBtnMore");

    if(!openBtn || !bd || !list || !btnCall || !btnKakao || !btnReserve || !btnMore) return;

    function openModal(){
      bd.classList.add("open");
      bd.setAttribute("aria-hidden", "false");
    }
    function closeModal(){
      bd.classList.remove("open");
      bd.setAttribute("aria-hidden", "true");
    }

    function selectBranch(b){
      state.branch = b;
      branchText.textContent = `${b.name} 선택됨 (변경하려면 클릭)`;

      // ✅ 지점 선택도 찍고 싶으면 유지 / 원치 않으면 아래 1줄 주석 처리
      sendClickEvent({ action:"branch_select", branch:b.name, source:"cta" });

      closeModal();
    }

    function renderList(){
      list.innerHTML = "";
      HB_CTA_BRANCHES.forEach(b=>{
        const row = document.createElement("div");
        row.className = "hb-item";
        row.innerHTML = `<div>${b.name}</div><div class="hb-badge">선택</div>`;
        row.addEventListener("click", ()=> selectBranch(b));
        list.appendChild(row);
      });
    }

    function requireBranchOrOpen(e){
      if(!state.branch){
        e.preventDefault();
        openModal();
        return true;
      }
      return false;
    }

    renderList();
    openBtn.addEventListener("click", openModal);
    closeBtn.addEventListener("click", closeModal);
    bd.addEventListener("click", (e)=>{ if(e.target === bd) closeModal(); });

    // ✅ CTA: 전화
    btnCall.addEventListener("click", (e)=>{
      e.preventDefault();
      if(requireBranchOrOpen(e)) return;

      const telHref = toTelHref(state.branch.phone);
      if(!telHref) return;

      sendClickEvent({ action:"call", branch:state.branch.name, source:"cta" });
      window.location.href = telHref;
      }, 150);
    });

    // ✅ CTA: 카톡
    btnKakao.addEventListener("click", (e)=>{
      e.preventDefault();
      if(requireBranchOrOpen(e)) return;

      const href = state.branch.kakao;
      if(!href){
        safeToast("준비중입니다.");
        sendClickEvent({ action:"kakao_pending", branch:state.branch.name, source:"cta" });
        return;
      }
      sendClickEvent({ action:"kakao", branch:state.branch.name, source:"cta" });
      window.open(href, "_blank", "noopener,noreferrer");
      }, 150);
    });

    // ✅ CTA: 네이버예약 (오버레이 예약과 "동일 action=reserve"로 기록 → 리포트 합산)
    btnReserve.addEventListener("click", (e)=>{
      e.preventDefault();
      if(requireBranchOrOpen(e)) return;

      const href = state.branch.reserve || "";
      if(!href) return;

      sendClickEvent({ action:"reserve", branch:state.branch.name, source:"cta" });
      window.open(href, "_blank", "noopener,noreferrer");
    });

    // ✅ CTA: 더 알아보기
    btnMore.addEventListener("click", ()=>{
      sendClickEvent({ action:"more", branch:(state.branch?.name || ""), source:"cta" });
    });

    // ✅ 기존 로직이 --ctaH를 쓰고 있어서, 우리 CTA 높이도 반영
    function setHbCtaHeightVar(){
      const cta = document.getElementById("hbFixedCta");
      const h = cta ? Math.round(cta.getBoundingClientRect().height) : 0;
      document.documentElement.style.setProperty('--ctaH', h + 'px');
    }
    window.addEventListener('resize', setHbCtaHeightVar);
    window.addEventListener('orientationchange', ()=> setTimeout(setHbCtaHeightVar, 250));
    window.addEventListener('load', ()=> setTimeout(setHbCtaHeightVar, 50));
    setHbCtaHeightVar();
  })();
</script>

</body>
</html>
